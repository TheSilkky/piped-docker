---
kind: pipeline
type: docker
name: backend

steps:
  - name: build & push
    image: thegeeklab/drone-docker-buildx
    privileged: true
    settings:
      context: ./backend
      dockerfile: ./backend/Dockerfile
      repo: git.silkky.dev/ellie/piped-backend
      tags: latest,09f3e0e595cd8e7c51e7cbbfab3c2990cc3ed932
      registry: git.silkky.dev
      username:
        from_secret: docker_username
      password:
        from_secret: docker_token

trigger:
  branch:
    - main

---
kind: pipeline
type: docker
name: proxy

steps:
  - name: build & push
    image: thegeeklab/drone-docker-buildx
    privileged: true
    settings:
      context: ./proxy
      dockerfile: ./proxy/Dockerfile
      repo: git.silkky.dev/ellie/piped-proxy
      tags: latest,6aeefc03e2388b9de8698b137a6e55c69d642160
      registry: git.silkky.dev
      username:
        from_secret: docker_username
      password:
        from_secret: docker_token

trigger:
  branch:
    - main

---
kind: pipeline
type: docker
name: frontend

steps:
  - name: build & push
    image: thegeeklab/drone-docker-buildx
    privileged: true
    settings:
      context: ./frontend
      dockerfile: ./frontend/Dockerfile
      repo: git.silkky.dev/ellie/piped-frontend
      tags: latest,cbaa3f4ee0c76814388ab2fb88fccd0b0925bff4
      registry: git.silkky.dev
      username:
        from_secret: docker_username
      password:
        from_secret: docker_token

trigger:
  branch:
    - main
